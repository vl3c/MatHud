# Statistics test coverage matrix

This document tracks test coverage for the statistics plotting stack (distributions, plots, bars).
It is intended to make it easy to see what is covered today and what branches still need tests.

## Scope

1. AI tool schemas: `plot_distribution`, `plot_bars`, `delete_plot`
2. Client dispatch: tool name -> `Canvas` -> `DrawableManager` -> `StatisticsManager`
3. Managers: `StatisticsManager`, `BarManager`
4. Drawables: `Bar`, `Plot` and subclasses (`ContinuousPlot`, `DiscretePlot`, `BarsPlot`)
5. Workspace restore: plot composites and derived components
6. Rendering: `Bar` rendering helper

## Coverage matrix

| Area                | Entry point / behavior                                                  | Code                                                                       | Tests                                                                                                         | Notes                                                                           |
| ------------------- | ----------------------------------------------------------------------- | -------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------- |
| Tool schema         | Plot tool schemas exist and remain stable                               | `static/functions_definitions.py`                                          | `server_tests/test_plot_tool_schemas.py`                                                                      | Covered (schema drift guard)                                                    |
| Client dispatch     | Tool mapping includes plot tools                                        | `static/client/function_registry.py`                                       | `static/client/client_tests/test_function_calling.py`                                                         | Covered (tool call dispatch via `ProcessFunctionCalls.get_results`)             |
| Plot: continuous    | Creates `ContinuousPlot` + `Function` + `FunctionsBoundedColoredArea`   | `static/client/managers/statistics_manager.py`                             | `static/client/client_tests/test_statistics_manager.py::test_plot_distribution_continuous_creates_components` | Covered with `draw_enabled=False`                                               |
| Plot: continuous    | Deletes plot and its components                                         | `static/client/managers/statistics_manager.py`                             | `static/client/client_tests/test_statistics_manager.py::test_delete_plot_continuous_removes_components`       | Covered                                                                         |
| Plot: continuous    | Validates representation/type/sigma/bounds and defaults params          | `static/client/managers/statistics_manager.py`                             | `static/client/client_tests/test_statistics_manager.py`                                                       | Covered (key validation branches)                                               |
| Plot: continuous    | Generates unique plot names                                             | `static/client/managers/statistics_manager.py`                             | `static/client/client_tests/test_statistics_manager.py::test_plot_distribution_generates_unique_plot_names`   | Covered                                                                         |
| Plot: discrete      | Creates `DiscretePlot` + `Bar` drawables                                | `static/client/managers/statistics_manager.py`                             | `static/client/client_tests/test_statistics_manager.py::test_plot_distribution_discrete_creates_bars`         | Covered                                                                         |
| Plot: discrete      | Deletes plot and derived bars                                           | `static/client/managers/statistics_manager.py`                             | `static/client/client_tests/test_statistics_manager.py::test_delete_plot_discrete_removes_bars`               | Covered                                                                         |
| Bars plot           | Creates `BarsPlot` + derived `Bar` drawables                            | `static/client/managers/statistics_manager.py`                             | `static/client/client_tests/test_statistics_manager.py::test_plot_bars_creates_components_and_labels`         | Covered (labels and naming)                                                     |
| Bars plot           | Bar spacing affects derived bar positions                               | `static/client/managers/statistics_manager.py`                             | `static/client/client_tests/test_statistics_manager.py::test_plot_bars_spacing_affects_positions`             | Covered                                                                         |
| Bars plot           | Deletes plot and derived bars                                           | `static/client/managers/statistics_manager.py`                             | `static/client/client_tests/test_statistics_manager.py::test_delete_plot_bars_removes_components`             | Covered                                                                         |
| BarManager          | Create/update/delete, name handling, and input validation               | `static/client/managers/bar_manager.py`                                    | `static/client/client_tests/test_bar_manager.py`                                                              | Covered (update-existing, generated names, non-finite rejection, archive flags) |
| Distributions utils | `normal_pdf_expression`, `default_normal_bounds`, and finite validation | `static/client/utils/statistics/distributions.py`                          | `server_tests/test_statistics_pure.py`                                                                        | Covered (finite validation and bounds checks)                                   |
| Drawables: state    | `Bar` state, deepcopy, translation                                      | `static/client/drawables/bar.py`                                           | `server_tests/test_statistics_pure.py`                                                                        | Covered                                                                         |
| Drawables: state    | Plot composite states and deepcopy                                      | `static/client/drawables/*_plot.py`                                        | `server_tests/test_statistics_pure.py`                                                                        | Covered                                                                         |
| Canvas state export | Omits plot-derived `Bar` drawables from serialized canvas state         | `static/client/canvas.py`                                                  | `static/client/client_tests/test_workspace_plots.py::test_canvas_state_omits_derived_plot_bars`               | Covered (keeps AI prompt compact)                                               |
| Workspace restore   | Restores plot composites from workspace and materializes derived bars   | `static/client/workspace_manager.py` and `StatisticsManager.materialize_*` | `static/client/client_tests/test_workspace_plots.py`                                                          | Covered (restore + derived bars + delete_plot)                                  |
| Rendering           | Bar renders fill polygon and labels correctly                           | `static/client/rendering/helpers/bar_renderer.py`                          | `static/client/client_tests/test_bar_renderer.py`                                                             | Covered (primitives + labels + guard clauses)                                   |
