# Delivery Plan (AI-First P0/P1/P2)

## Product Direction (Source of Truth)
- MatHud is an AI-augmented app: user intent is expressed in chat, AI executes tool workflows, HUD canvas visualizes results.
- Prioritize capabilities that improve AI intent interpretation, deterministic execution, and clear visual feedback in the HUD.
- UI gestures are secondary unless they directly support AI workflows (inspection, confirmation, lightweight overrides).

## P0 - Reliability (implement first)
- ~~refactor oversized classes/functions into smaller composable units while preserving 1:1 behavior (no logic changes); improve observability, readability, and structural clarity~~
- ~~make `search_tools` the default tool-discovery path to reduce initial context payload; deprecate legacy preloaded full-tool-list model prompting~~
- audit canvas state structure end-to-end and redesign AI-facing state summaries for high-object-count scenes to improve readability and reasoning quality
- implement OpenAI OAuth for first-party subscription-token usage (third-party app flow) and make OAuth the default authentication path over raw API-key entry
- perform a deep review of drawable dependency architecture and relationship rules; verify interaction coverage across drawable types and close logic gaps
- build a reproducible Android-target packaging/deployment pipeline for a mobile-runnable app variant
- defer full WebGL parity checks until WebGL reaches feature completeness (text/labels and full drawable coverage)
- add deterministic tool-execution logs and replayability for AI action traces (inputs, resolved targets, resulting state deltas)

## P1 - Core User Value (implement after P0)
- constraint resolution and semantic snapping: resolve references like nearest endpoint/intersection/midpoint/on-curve target during tool execution
- coordinate readout and confirmations: return exact resolved coordinates/objects in responses and HUD overlays
- tabular workflow: create/query/update data tables from chat with HUD-linked previews
- CSV workflow: import/export datasets through chat commands with validation and schema feedback
- plotting suite: scatter/histogram/box plots, polar plots, implicit plots from natural language intents
- geometric construction toolkit: midpoint/perpendicular/parallel/bisectors/circle-through-3-points through declarative commands
- relation inspector: explain and verify geometric relations (parallel/perpendicular/collinear/concyclic/equal-length) on demand
- transform workflows: reflection/dilation/shear/rotation/translation using object references and constraint-aware execution
- interaction tools: tracing, root/extrema/intersection discovery, parameter sweeps, and dynamic slider orchestration from chat
- statistics workflows: summaries, additional distributions, and probability calculators with explanation-friendly output

## P2 - Advanced and Expansion
- construction history timeline with natural-language rewind/replay and branch exploration
- reusable macros: user-defined higher-level commands composed from existing tool primitives
- vector field and contour/heatmap generation with explainable parameterization
- graph-theory workflow: graph generation, editing, matrix views, and algorithm playback controlled through chat
- workspace orchestration: split-screen/tabbed/dual-view layouts selected and managed based on task context
- animation controls: timeline/loop/speed/locus generation via declarative commands
- session snapshots and diff/restore for reproducible exploratory workflows
- command palette and shortcut management (optional power-user overlay over core conversational UX)
- 3D roadmap: 3D graphing and shape workflows once 2D reliability/value goals are complete

## Milestones
- Milestone 1 (Stability): complete all P0 reliability and deterministic execution foundations
- Milestone 2 (AI Interaction Core): semantic snapping/constraint resolution, coordinate confirmations, table + CSV flows
- Milestone 3 (AI Plotting + Stats): plotting suite plus distribution/probability/stat-summary workflows
- Milestone 4 (AI Geometry): construction toolkit, relation inspector, and transform workflows
- Milestone 5 (AI Exploratory Workflow): tracing/sliders/interactive graph workflows and algorithm playback
- Milestone 6 (Advanced): remaining P2 capabilities (automation, visualization, productivity, 3D)

# Backlog

## Reliability and Execution Integrity
_Elaborates on P0 goals with ongoing design principles._
- strict validation and canonicalization of tool arguments before execution
- deterministic ordering for ambiguous target resolution (stable tie-break rules)
- WebGL parity and label support after WebGL matures

## Intent Resolution and Constraints
- semantic snapping modes: endpoint/intersection/midpoint/nearest-on-curve/grid quantization
- tolerance policy management for intent resolution (global defaults + per-command overrides)
- conflict handling when user intent is under-specified (ask-back strategy vs deterministic fallback)
- explainable resolution traces in AI responses (what was selected, why, and resulting coordinates)

## Data and Plot Workflows
- conversational table model for numeric/symbolic columns with formula support
- CSV import cleanup (typing, missing values, delimiter/header inference)
- plotting from natural language over table columns and computed expressions
- residual/regression diagnostics and model-comparison flows expressed conversationally
- reusable analysis templates callable as macros

## Geometry and Math Tooling
- declarative geometric constructions and relation proofs/checks
- linear algebra workflows (rref/eigen decomposition and related explainability output)
- sequence/series/summation/product and numeric integration flows optimized for conversational use
- inequality/system region generation driven by intent + constraints
- conic and advanced curve workflows with parameter exploration

## Exploration, Collaboration, and Productivity
- session snapshots with semantic diffs suitable for AI summarization
- reproducible command/run logs that can be replayed in CI for regression detection
- "what changed" summaries after complex action batches
- optional command palette and keyboard editor for hybrid users without weakening AI-first design

## Future 3D and Extended Visualization
- staged 3D rendering architecture compatible with AI-driven command model
- 3D object/scene constraints and semantic target resolution
- 3D camera/navigation intent handling through conversational controls

## Parked (revisit when core AI workflows mature)
- differential equations solver and direction field visualization
- numerical ODE solvers
- truth tables and boolean algebra workflows
- financial mathematics (compound interest, annuities, amortization)
- hypothesis testing (z-test, t-test, chi-square, F-test), ANOVA, confidence intervals
- probability plots (Q-Q, P-P) and cumulative frequency tables

## Static Typing Rollout
- add type stubs or protocols for Brython `browser` module usage in client code

## Recent Completions
- 2026-02-08: made `search_tools` the default tool-discovery path for app/provider initialization (search-first tool mode), with route/provider fallback handling for constructor compatibility. Validation: `pytest -q server_tests/test_routes.py` (30 passed), `pytest -q server_tests` (770 passed, 22 skipped, 117 subtests passed), `python -m cli.main test client --start-server --port 5000 --timeout 240` (2337 run, 0 failures, 0 errors). Commits: `47698ef` (feature), `86f6847` (ignore local runtime artifacts).
- 2026-02-08: expanded client unit-test coverage for PR #16 helper extractions (Canvas/WorkspaceManager pure helpers), integrated into the Brython client test suite, and verified via `venv\Scripts\python -m cli.main test client` (2313 tests, 0 failures).
- 2026-02-08: completed phased no-logic-change composable refactor stream (Phases 0-5), including manager/orchestrator/tool-pipeline decomposition, helper-level coverage expansion, and final hardening sign-off. Validation: full server regression (`769 passed, 22 skipped`) and full client regression (`2319 run, 0 failures`).
